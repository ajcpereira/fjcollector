

#                       IDENTIFICATION DIVISION



# FJ Data Collector

This is an aggregator for data collection that populates data in InfluxDB and since Grafana integrates with Infludb you can draw your graphs in Grafana.

The Collector is a scheduler that collects information based in a YAML file, each schedule runs on it's own thread and it uses python:
https://github.com/ajcpereira/fjcollector

Regarding the other 2 mention applications be aware of their licenses if you wish to use in your organization.
Our makefile installs both but they are not part of the code of the fjcollector, so you should check your policies or maybe you already have them in your organization so you can use them:

Grafana - https://grafana.com/licensing/ - 26/07/2023: (...) On April 20, 2021, Grafana Labs announced that going forward, our core open source projects will be moving from the Apache License v2.0 to AGPLv3.
Users who donâ€™t intend to modify Grafana code can simply use our Enterprise download. This is a free-to-use, proprietary-licensed, compiled binary that matches the features of the AGPL version, and can be upgraded to take advantage of all the commercial features in Grafana Enterprise (Enterprise plugins, advanced security, reporting, support, and more) with the purchase of a license key. (...)

Influxdb - https://www.influxdata.com/ - 18/12/2023: https://github.com/influxdata/influxdb/blob/master/LICENSE (...) MIT License
Copyright (c) 2018 InfluxData (...)

### Requirements

Requires linux

Requires docker

Requires git

Requires curl

Internet access to github.com

Will install under folder /opt/fjcollector

The setup will need to be run with root so it can create the structure in /opt and change the owners of the files to user fjcollector

### Pre-Setup

Requires user 'fjcollector'

Every system you need to ssh make sure you generate a private key and in the destination you use the public key in the authorized keys, then keep the private keys under:
  /opt/fjcollector/collector/keys
If different keys are used they may be specified in the config.yaml

We recommend to you have a look in the functions Readme

If your network needs a proxy you need to setup in you shell session but also inside the Dockerfile 'install/Dockerfile' and in the docker-compose.yml, the lines are commented, so, just uncomment it and insert your IP.

### Installation Procedure

Clone the git repository:

````
git clone https://github.com/ajcpereira/fjcollector.git
````

Now, just run the install

````
cd fj-collector
sudo make setup
````

edit /opt/fjcollector/collector/config/config.yaml

For each IP that you access through ssh you will need the private key.
On the previous file (config.yaml) you can specifie it's location (host_keys entry)
Be aware that since the code runs inside a container the config.yaml uses the path inside of the container, so:
  /collector/fjcollector/config/
  is your
  /opt/fjcollector/collector/config/

  We recommend you use relative paths:
    host_keys: keys/id_rsa
    logfile: logs/fjcollector.log
 
### collector.yaml
````
systems:
  - name: MYCS0100
    resources_types: eternus_cs8000
    config:
      parameters:
        user: fjcollector
        host_keys: keys/id_rsa
        poll: 1
      metrics:
        - name: fs_io
        - name: fs
        - name: cpu
        - name: mem
        - name: drives
      ips:
        - ip:  192.168.18.46
          alias: linux14
        - ip:  192.168.18.46
          alias: linux02
global_parameters:
  repository: influxdb
  repository_port: 8086
  repository_protocol: tcp
  repository_api_key: AUTOGENERATED_DURING_SETUP
  loglevel: DEBUG
  logfile: logs/fjcollector.log
  auto_fungraph: yes
  grafana_api_key: AUTOGENERATED_DURING_SETUP
  grafana_server: grafana
````  

### Metrics

Consult the README inside the folder functions

### Metrics Retention

By default the bucket that will retain the information in Influxdb is of 3 years, manual change must be done if you wish to have a different retention.
You can remove and create a new bucket just make sure the name is 'fjcollector'.


### Architecture
![Design](https://github.com/ajcpereira/reporting/raw/main/img/design.png)
